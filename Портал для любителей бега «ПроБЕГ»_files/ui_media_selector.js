!function(e){var a={};function t(i){if(a[i])return a[i].exports;var o=a[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=a,t.d=function(e,a,i){t.o(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,a){if(1&a&&(e=t(e)),8&a)return e;if(4&a&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&a&&"string"!=typeof e)for(var o in e)t.d(i,o,function(a){return e[a]}.bind(null,o));return i},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,a){return Object.prototype.hasOwnProperty.call(e,a)},t.p="",t(t.s=7)}({212:function(e,a,t){"use strict";t.r(a),t.d(a,"post",function(){return d}),t.d(a,"plainget",function(){return r}),t.d(a,"plaingetCancelable",function(){return s});var i=window.ajax,o=2;function d(e,a,t){return a&&(a.im_v=o),new Promise(function(o,d){i.post(e,a,{timeout:t,onDone:function(){o.apply(null,[[].concat(Array.prototype.slice.call(arguments))])},onFail:function(){return d.apply(null,arguments),!0}})})}function r(e,a){return s(e,a,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).request}function s(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0;return o=window.XDomainRequest?new XDomainRequest:i._getreq(),{request:new Promise(function(i,d){var r=void 0,s=Date.now(),n=t.timeout||60,l=ajx2q(a);if(window.XDomainRequest)o.open("get",e+"?"+l),o.ontimeout=function(e){d([e,{}])},o.onerror=function(e){d([e,{}])},o.onload=function(){i([o.responseText,{}])},setTimeout(function(){o.send()},0);else{o.onreadystatechange=function(){4==o.readyState&&(clearInterval(r),o.status>=200&&o.status<300?i([o.responseText,o]):d([o.responseText,o]))};try{o.open("GET",e+"?"+l,!0)}catch(e){return d([e,o])}o.send()}r=setInterval(function(){Date.now()-s>1e3*n&&(d(["",{}]),clearInterval(r))},1e3)}),cancel:function(){o.abort()}}}},7:function(e,a,t){e.exports=t(92)},92:function(e,a,t){"use strict";t.r(a);var i=t(212),o=function(){return function(e,a){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,a){var t=[],i=!0,o=!1,d=void 0;try{for(var r,s=e[Symbol.iterator]();!(i=(r=s.next()).done)&&(t.push(r.value),!a||t.length!==a);i=!0);}catch(e){o=!0,d=e}finally{try{!i&&s.return&&s.return()}finally{if(o)throw d}}return t}(e,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d="anonymous",r="poll_fixed",s="poll_closed",n="poll_background_id",l="poll_photo_id",c="poll_until",_="poll_is_multiple";window.MediaSelector=function(e,a,t,p){var u,h=[],m=(p=p||{}).mediaHandlers||{};each(t||[],function(a,t){var i=t[0],o=t[1],d=t[2];if(o){var r=!1,s=p.toId||cur.postTo,n={to_id:s,blockPersonal:p.blockPersonal};switch(n.mail_add=p.mail?1:"",n.from=p.from,i){case"graffiti":r=showBox.pbind("al_wall.php",{act:"canvas_draw_box",to_id:s,flash:browser.flash},{cache:1,dark:1});break;case"photos_list":r=showBox.pbind("al_photos.php",extend(n,{act:"choose_photo"}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"photo":r=m.photo?m.photo.pbind(p):showBox.pbind("al_photos.php",extend(n,{act:"choose_photo",max_files:p.limit||10}),{cache:1,stat:["photos.js","photos.css","upload.js"],dark:1});break;case"video":var l=vk.widget?0:1,c=extend(n,{act:"a_choose_video_box",max_files:p.limit||10,upload:l});r=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||showBox("al_video.php",c,{cache:1,dark:1})};break;case"audio":r=function(){var a=domClosest("_submit_post_box",e);hasClass(a,"anon_field_on")||stManager.add(["audio.js","indexer.js","auto_list.js","grid_sorter.js","audio.css"],function(){var a=!1;each(u.chosenMedias||[],function(){"audio_playlist"==this[0]&&(a=!0)}),cur.audioAttachOriginalOwnerId=!1,cur.audioAttachSwitchOwnerId=!1;var t=vk.id,i=parseInt((""+n.to_id||"").replace(/^board/,"-")),o=domClosest("_submit_post_box",e);domData(o,"from-oid")<0?(t=i,cur.audioAttachOriginalOwnerId=i,cur.audioAttachSwitchOwnerId=vk.id):cur.hasGroupAudioAccess&&(cur.audioAttachOriginalOwnerId=vk.id,cur.audioAttachSwitchOwnerId=i),AudioPage.showAttachBox(t,{canPlaylistAttach:!a&&!cur.editor,onAudioChoose:AudioUtils.onAudioChoose,onPlaylistChoose:AudioUtils.onPlaylistChoose})})};break;case"poll":r=function(){return u.chooseMedia("poll","",d)};break;case"doc":var _=p.docParams||{};_=extend(_,{act:"a_choose_doc_box"}),r=m.doc?m.doc.pbind(p):showBox.pbind("docs.php",extend(n,_),{stat:["docs.css"]});break;case"map":r=showBox.pbind("al_places.php",extend(n,{act:"a_choose_place_box"}),{stat:["places.css","map.css","maps.js","ui_controls.css","ui_controls.js","boxes.css"],width:640,bodyStyle:"padding: 0px;",dark:1});break;case"note":r=showWiki.pbind({note:"new"},!0,!1,{queue:1});break;case"postpone":r=function(){return u.chooseMedia("postpone",o,d)};break;case"mark_as_ads":r=function(){return u.chooseMedia("mark_as_ads",o,d)};break;case"share":r=function(){window.onShareChooseUrlBoxInit=function(){var e=geByClass1("share_url_input",curBox().bodyNode);addEvent(e,"keydown",function(e){if(e.which==KEY.ENTER)return a(curBox().btns.ok[0],e),!1})};var e=showBox("share.php",{act:"choose_url_box"},{dark:1}),a=function(a,t){var i=geByClass1("share_url_input",e.bodyNode),r=val(i);lockButton(a),disable(i,!0),hide("share_url_error"),u.chooseMedia("share",o,extend(d,{url:r,draft:!0,onSuccess:function(){disable(i,!1),unlockButton(a),e.hide()},onError:function(e){var t="";e&&e!==getLang("global_unknown_error")&&(t=e+" "),disable(i,!1),unlockButton(a),ge("share_url_error").innerHTML=t+getLang("global_share_link_failed"),show("share_url_error")}}))};e.removeButtons(),e.addButton(getLang("global_continue"),a)};break;case"pretty_cards":r=function(e){e&&e.replace_owner_id&&(d.editor.owner_id=e.replace_owner_id),u.chooseMedia("pretty_cards",o,d)};break;case"gift":r=function(){var e=(e=p.peer<2e9?p.peer:0)||cur.peer;p.giftBoxPrepare&&p.giftBoxPrepare(e),showBox("al_gifts.php",{act:"get_gift_box",mid:e,fr:e==vk.id?1:0},{stat:["gifts.css","wide_dd.js","wide_dd.css"],dark:1})};break;case"money":r=function(){var e=cur.peer;s>-2e9&&s<0&&(n.owner_id=s),showBox("al_payments.php",extend(n,{act:"money_transfer_box",to_id:e}),{onFail:function(e){return setTimeout(showFastBox(getLang("global_error"),e).hide,2e3),!0}})};break;case"market":s==vk.id?(r=showBox.pbind("al_market.php",extend(n,{act:"a_choose_user_product_box"}),{cache:1}),d.tt_words&&(cur.checkMessageHandler=function(e){if(!cur.marketIntroShown&&(e=" "+e+" ").match(new RegExp("\\s("+d.tt_words.join("|")+")\\s","i"))){var a=getSize(u.menu.moreWrap);showTooltip(u.menu.moreWrap,{text:d.tt_text,dir:"left",slideX:15,width:230,shift:[-a[0]-5,-a[1]/2],hasover:1}),cur.marketIntroShown=!0}})):r=showBox.pbind("al_market.php",extend(n,{act:"a_choose_product_box"}),{cache:1});break;case"article":r=function(){return openArticleEditor(s)}}h.push([i,o,r])}});var g=p.limit||10,v=g>1,w=p.editable&&(!browser.msie||parseInt(browser.version)>8),f=p.sortable&&(!browser.msie||parseInt(browser.version)>8),b=function(e,a,t){if(!(e=ge(e)))return!1;t=t||{},window.__addMediaIndex||(window.__addMediaIndex=0);var i=++__addMediaIndex;e.innerHTML='<div class="media_selector clear_fix"></div>';var o,d=domByClass(e,"media_selector"),r=[],s={id:i,menuNode:d,types:a,lastTypes:a,activate:function(e){s.touched=!0===e,t.onActivate&&t.onActivate()},show:function(){if(o&&(clearTimeout(o),o=0),s.moreWrap&&!hasClass(s.moreWrap,"shown")){t.forceToUp||replaceClass(s.moreWrap,"to_up","to_down");var e=domByClass(s.moreWrap,"_more_items"),a=getClientRectOffsetY(e);(a>0||t.forceToUp)&&replaceClass(s.moreWrap,"to_down","to_up"),setTimeout(addClass.pbind(s.moreWrap,"shown"),0)}},hide:function(e){function a(a){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e){if(!o){var a=function(){o=0,s.moreWrap&&removeClass(s.moreWrap,"shown")};if(e){var t=domByClass(s.moreWrap,"_more_items");hide(t),a(),setTimeout(show.pbind(t),0)}else o=setTimeout(a,300)}}),setOptions:function(e){extend(t,e)},setItems:function(e){for(window.tooltips&&tooltips.destroyAll(d);d.firstChild;)re(d.firstChild);var a=void 0!==t.hideAfterCount?t.hideAfterCount:4,i=void 0!==t.maxShown?t.maxShown:3,o=!1,n=t.hideItem,l=(n||e.length>a)&&(!browser.mobile||t.ignoreMobile),c=n&&t.hideLabel||getLang("global_media_selector_more");function _(e,a,i,o,d,n){var l=ce("a",{innerHTML:o?a:'<span class="blind_label">'+a+"</span>",className:"ms_item ms_item_"+e+" _type_"+e});if(!o&&s.moreWrap?domInsertBefore(l,s.moreWrap):(o||d).appendChild(l),l.setAttribute("tabindex",0),!o){l.setAttribute("data-title",a),l.setAttribute("aria-label",a),l.setAttribute("role","link");var c=function(){hasClass(this,"ms_item_article_highlight")||showTitle(this,!1,n||!1,{noZIndex:!0})};addEvent(l,"mouseover",c),r.push(function(){removeEvent(l,"mouseover",c)})}if(i&&!cur.viewAsBox){var _=function(){return s.activate(),s.hide(!0),!(t.onItemClick&&!t.onItemClick(e))&&(i(),!1)};addEvent(l,"click",_),r.push(function(){removeEvent(l,"click",_)})}}s.moreWrap=!1,s.lastTypes=e,each(e,function(e,a){var p=a[0],u=a[1],h=a[2];if("article"!=p){if(l&&(n?p==n:e==i)){var m=d.appendChild(ce("div",{className:"ms_items_more_wrap"})),g=function(e){s.fromKeyboard=checkKeyboardEvent(e),"mouseover"==e.type&&(s.touched||s.fromKeyboard)||(s.fromKeyboard&&hasClass(s.moreWrap,"shown")?s.hide():s.show())},v=function(){s.fromKeyboard||s.hide()};addEvent(m,"mouseover click",g),addEvent(m,"mouseout",v),r.push(function(){removeEvent(m,"mouseover click",g),removeEvent(m,"mouseout",v)}),t.vectorIcon&&(c='<span class="blind_label">'+c+"</span>",addClass(m,"ms_items_more_wrap_vector"));var w=m.appendChild(ce("a",{className:"ms_item_more",innerHTML:'<span class="ms_item_more_label">'+c+"</span>"}));w.setAttribute("tabindex",0),w.setAttribute("role","button");var f=ce("div",{className:"ms_items_more_helper"});o=ce("div",{className:"ms_items_more _more_items"}),f.appendChild(o),m.appendChild(f),s.moreWrap=m}_(p,u,h,o,d)}else isArticleEditorAvailable()&&_(p,u,h,!1,d,[6,8])})}};a&&s.setItems(a),browser.msie&&(removeEvent(e,"MSPointerDown"),addEvent(e,"MSPointerDown",s.activate.pbind(!0)));removeEvent(e,"mouseover"),addEvent(e,"mouseover click",s.activate),t.global||cur.destroy.push(function(){removeEvent(e,"mouseover click",s.activate)});t.forceToUp&&addClass(geByClass1("ms_items_more_wrap",d),"to_up");return s.handlersToClean=r,s}(e,h,{onActivate:function(){cur.attachCount=u.attachCount,cur.chooseMedia=u.chooseMedia,cur.hasChosenMedia=u.hasChosenMedia,cur.lastAddMedia=u,cur.onMediaUploadStarted=p.onMediaUploadStarted,cur.showMediaProgress=u.showMediaProgress,cur.unchooseMedia=u.unchooseMedia,cur.updateChosenMedia=u.updateChosenMedia},onItemClick:function(e){return!(v&&u.attachCount()>=g&&"postpone"!==e&&"mark_as_ads"!==e)||(vk.widget?showBox("blank.php",{code:1900,limit:g}):showFastBox(getLang("global_error"),getLang("attachments_limit",g)),!1)},hideAfterCount:p.hideAfterCount,topOffset:p.topOffset,forceUp:p.forceUp,global:p.global,maxShown:p.maxShown,forceToUp:p.forceToUp,vectorIcon:p.vectorIcon,ignoreMobile:p.ignoreMobile});if(b){a=a||"media_preview";var k=intval(b.id),y=ge(a);if(v){y.innerHTML='<div id="page_pics_preview'+k+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_dpics_preview'+k+'" class="page_pics_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_docs_preview'+k+'" class="page_docs_preview post_thumbed_media page_media_sortable media_preview clear_fix"></div><div id="page_pdocs_preview'+k+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_ldocs_preview'+k+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_mpics_preview'+k+'" class="page_pics_preview media_preview clear_fix"></div><div id="page_ppdocs_preview'+k+'" class="page_docs_preview media_preview clear_fix"></div><div id="page_progress_preview'+k+'" class="page_progress_preview media_preview clear_fix"></div>';var C=domFC(y),x=domNS(C),S=domNS(x),M=domNS(S),P=domNS(M),A=domNS(P),B=domNS(A),I=domNS(B);removeClass(y,"media_preview"),addClass(y,"multi_media_preview")}else addClass(y,"med_no_attach"),show(y);return u={_addMediaLink:e,lnkId:k,menu:b,types:h,phLists:{},handlers:{},chosenMedias:[],_showAddMedia:function(){b.show()},_hideAddMedia:function(e){b.hide(e)},hasRestrictingAttach:function(){return geByClass1("medadd_c_market",S)||geByClass1("medadd_c_story",S)},updateChosenMedia:function(e,a,t){u.chooseMedia(e,a,t,null,null,null,!0)},hasChosenMedia:function(e,a){var t=!1;return each(u.chosenMedias,function(){if(this[0]===e&&this[1]===a)return t=!0,!1}),t},chooseMedia:function(a,t,i,o,d,r,s){if(!cur.articleEditorLayer||"article"==a){if(vk.widget&&(t=clean(t)),u.onChange&&!1===u.onChange(a,t,i,o))return void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),!1;if("note"==a&&(cur.pbNoteAdded=!1),inArray(a,p.disabledTypes||[]))return!1;if(u.attachCount()>=g&&void 0===i.upload_ind&&"postpone"!==a&&"mark_as_ads"!==a||u.hasRestrictingAttach()){if(v)return!1;u.unchooseMedia()}var n=!1,l={},c=null;if(v&&(each(u.chosenMedias,function(e){if(c=e,this[0]==a&&this[1]==t)return n=!0,!1;l[this[0]]=l[this[0]]?l[this[0]]+1:1}),n&&!s||s&&!n))return!1;var _,h,m="",I="",T=!1,L=S,N="";switch(a){case"graffiti":isObject(i)||(i={thumb:i||""}),m='<div class="fl_l page_preview_graffiti"><img class="page_preview_graffiti" src="'+(i=de(i)).thumb+'" /></div>',L=T=A;break;case"photos_list":if(vk.widget)return!1;hide(this._addMediaLink),vkImage().src=i[1],(D=i[3].replace(/^{|}$/g,""))&&(D+=","),D+='"queue":1',m="<div"+(p.nocl?"":" onclick=\"return showPhoto('"+i[4]+"', '"+i[2]+"', '"+D.replace(/"/g,"&quot;")+');"')+' class="fl_l page_preview_photo"><img class="page_preview_photo" src="'+i[1]+'" /></div>',L=T=C;break;case"photo":if(l.pretty_cards)return!1;isObject(i)||(i={thumb_m:i[0]||"",thumb_s:i[1]||"",list:i[2]||"",view_opts:i[3]||"",upload_ind:i.upload_ind||void 0}),i=de(i),vkImage().src=i.thumb_m;var D=i.view_opts.replace(/^{|}$/g,"");if(vk.widget&&(D=D.replace(/&quot;/g,'"')),D&&(D+=","),D+='"queue":1',u.phLists[t]=i.list,w){if(!i.editable)return!1;if(!p.nocl){var E="{"+D+"}";E=vk.widget?JSON.parse(E):parseJSON(E),i.editable.click=u.showPhoto.pbind(t,i.list,E)}}m="<div "+(p.nocl?"":' onclick="return cur.addMedia['+u.lnkId+"].showPhoto('"+t+"', '"+i.list+"', {"+D.replace(/"/g,"&quot;")+'});"')+' class="fl_l page_preview_photo'+(r?" page_preview_ph_graff":"")+'"><img class="page_preview_photo" src="'+i.thumb_m+'" /></div>',T=1,L=C;break;case"video":if(l.pretty_cards)return!1;if(isObject(i)||(i={thumb:i||""}),w){if(!i.editable)return!1;p.nocl||(i.editable.click=showVideo.pbind(t,i.list_id,{queue:1,autoplay:1}))}i=de(i),m="<div "+(p.nocl?"":"onclick=\"return showVideo('"+t+"', '"+i.list_id+"', {queue:1,autoplay:1});\"")+' class="fl_l page_preview_video"><img class="page_preview_video" src="'+i.thumb+'" /></div>',T=1,L=C,h=i.list_id;break;case"article":if(vk.widget)return!1;if(l.article||l.share||l.page||l.pretty_cards||!i)return!1;m='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+getLang("global_article")+"</div>",I=i.snippet_html,t=i.url,i.rev&&(t+="?rev="+i.rev),L=P;break;case"audio":i=de(i),m=Page.addAudioPreview(clean(t),i),N=' id="pam'+k+"_audio"+clean(t)+'"';break;case"audio_playlist":if(l.audio_playlist)return!1;var U=(i=de(i)).coverUrl?"background-image:url('"+i.coverUrl+"'); background-size: cover;":"",z="";z=i.authorHref?'<a href="'+i.authorHref+'" onclick="return nav.go(this)">'+i.authorName+"</a>":i.authorName;var R="'"+(i.accessHash||"")+"'";I='<div class="audio_pl_attach_preview _audio_pl _audio_pl_'+i.ownerId+"_"+i.id+' clear_fix"><div class="audio_pl_attach_preview__play" onclick="return getAudioPlayer().playPlaylist('+i.ownerId+", "+i.id+", "+R+')"></div><div class="audio_pl_attach_preview__cover" style="'+U+'">'+(i.gridCovers||"")+'</div><div class="audio_pl_attach_preview__title">'+i.title+'</div><div class="audio_pl_attach_preview__info_line">'+z+"</div></div>",m='<span class="medadd_h">'+getLang("global_audio_playlist")+"</span>",L=P;break;case"doc":if(vk.widget||!i.lang)return!1;i.thumb&&i.thumb_s?(m="gif"==i.ext?'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" href="'+i.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+i.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint doc_gif">'+i.title+"</div>":'<a onclick="if (cur.cancelClick) return (cur.cancelClick = false);" target="_blank" href="'+i.href+'" class="pam_dpic"><div class="page_preview_doc_photo"><img src="'+i.thumb+'" align="center" /></div><div class="page_preview_doc_photo_hint">'+i.title+"</div>",I='</a><div class="pam_bg"></div>',L=T=x,N=' id="pam'+k+"_doc"+t+'"'):(m="",I='<div class="page_doc_row"><a target="_blank" href="'+i.href+'" class="page_doc_icon page_doc_icon'+intval(i.type)+'"></a><a target="_blank" href="'+i.href+'" class="page_doc_title">'+i.title+'</a><div class="page_doc_description_row"><div class="page_doc_size">'+i.size_str+"</div></div></div>",N=' id="pam'+k+"_doc"+t+'"');break;case"story":if(vk.widget)return!1;m='<div class="medadd_c_story"><a target="_blank" '+i.attr+'"><div class="medadd_c_story_thumb fl_l" style="background-image:url('+i.thumb+')"></div></a><div class="medadd_c_story_info fl_l"><a class="medadd_c_story_title" target="_blank" '+i.attr+'">'+i.title+'</a><div class="medadd_c_story_desc">'+i.date_string+"</div></div>",hide(e);break;case"mask":if(vk.widget)return!1;m='<div class="medadd_c_mask"><div class="medadd_c_story_thumb fl_l" style="background-image:url(/images/landings/vkmasks/masksSnippet_2x.png)"></div></a><div class="medadd_c_story_info fl_l"><div class="medadd_c_story_title">'+i.share.title+'</div><div class="medadd_c_story_desc">'+i.share.desc+"</div></div>";break;case"share":if(l.share||l.page||l.pretty_cards||!i.lang)return!1;if(isArray(i)&&(i={domain:i[0],url:i[1],initialPattern:i[2],title:i[3],description:i[4],images:[i[5]],user_id:i[6],photo_id:i[7]}),i.draft){var q={onSuccess:i.onSuccess,onError:i.onError};return u.checkURL(i.url,void 0,{},q),!1}if(!i.title&&!(cur.options.share||{}).allow_preview_empty_links)return(i.onError||function(){})(),!1;if(i.title=unclean((i.title||"").replace(/<br>/g,"\n")),i.description=unclean((i.description||"").replace(/<br>/g,"\n")),i.description_short=unclean((i.description_short||"").replace(/<br>/g,"\n")),i.description_narrow=unclean((i.description_narrow||"").replace(/<br>/g,"\n")),cur.options=cur.options||{},cur.options.share&&cur.options.share.max_title_len&&(i.title=(i.title||"").substr(0,cur.options.share.max_title_len)),cur.options.share&&cur.options.share.max_desc_len&&(i.description=(i.description||"").substr(0,cur.options.share.max_desc_len),i.description_short=(i.description_short||"").substr(0,cur.options.share.max_desc_len),i.description_narrow=(i.description_narrow||"").substr(0,cur.options.share.max_desc_len)),i.media=i.media||t,i.lang&&(cur.lang=extend(cur.lang||{},i.lang)),i=de(i),m='<a target="_blank" href="/away.php?to='+encodeURIComponent(i.url)+'" class="medadd_h medadd_h_link inl_bl">'+clean(unclean(i.lang.profile_choose_link))+"</a>",u.shareData=extend(u.shareData||{},i,{imagesStyles:[""]}),L=P,(i.onSuccess||function(){})(),(cur.options.share||{}).button_exclusive&&i.shareButtons)hide(e),(F=ge("signed"))&&disable(F);hide(domByClass(b.menuNode,"_type_share"));break;case"pretty_cards":if(l.share||l.pretty_cards||vk.widget)return!1;var F;m='<div class="medadd_h medadd_h_pretty_cards inl_bl">'+i.lang.global_wall_pretty_cards+"</div>",(F=ge("signed"))&&disable(F),hide(domByClass(b.menuNode,"_type_pretty_cards")),hide(e),L=P;break;case"poll":if(!i.lang||vk.vidget||l.poll||!M)return!1;hide(domByClass(b.menuNode,"_type_poll")),L=M;break;case"map":if(vk.widget)return!1;m="<div class=\"fl_l\"><a onclick=\"return showBox('al_places.php', {act: 'geo_box', lat: "+i[0]+", long: "+i[1]+", provider: "+intval(i[3])+'}, {dark: 1});"><div class="page_media_map_point"></div><img class="page_preview_map" width="340" height="127" src="/maps?lat='+i[0]+"&lng="+i[1]+"&z=11&"+(window.devicePixelRatio,"w=680&h=254")+'" /></a></div>',L=T=A,hide(domByClass(b.menuNode,"_type_map"));break;case"page":if(l.share||l.page||!i.lang||vk.widget)return!1;var j=i.media.split("_");m='<a href="/page'+i.media+'" onclick="return showWiki({oid: '+j[0]+", id: "+j[1]+'}, false, event, {queue: 1})" class="medadd_h medadd_h_page inl_bl">'+i.lang.profile_choose_page+"</a>",L=P;break;case"album":if(vk.widget)return!1;if(i.thumb.match(/^\/images\//)&&(i.thumb=""),w){if(!i.editable)return!1;extend(i.editable,{title:i.title,size:i.count,click:!p.nocl&&nav.change.pbind({z:"album"+t})})}var O=i.thumb;vkImage().src=O,_=p.nocl?"":' href="/album'+t+'" onclick="return nav.change({z: \'album'+t+"'}, event)\"",m='<a class="'+("fl_l page_album_link"+(O?"":" page_album_nocover"))+'" '+_+">\n              "+(O?'<div class="page_album_thumb_wrap"><img class="page_album_thumb" src="'+O+'"/></div>':"")+'\n              <div class="page_album_title">\n                <div class="page_album_size">'+i.count+'</div>\n                <div class="page_album_title_text">'+i.title+"</div>\n              </div>\n            </a>",T=1,L=C;break;case"note":if(!i.lang||vk.widget)return!1;m="<a onclick=\"showWiki({w: 'note"+i.raw+'\', edit: 1}, true, event, {queue: 1})" class="medadd_h medadd_h_note inl_bl">'+i.lang.profile_choose_note+"</a>",I='<div class="medadd_c medadd_c_note"><a onclick="showWiki({w: \'note'+i.raw+'\', edit: 1}, true, event, {queue: 1})" id="share_note_title'+i.raw+'">'+i.title+"</a></div>",L=P;break;case"market":if(vk.widget)return!1;m='<div class="medadd_c_market"><a target="_blank" href="'+i.href+'"><img class="medadd_c_market_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_market_info fl_l"><a class="medadd_c_market_title" target="_blank" href="'+i.href+'">'+i.title+'</a><div class="medadd_c_market_price">'+i.price+"</div></div>",hide(e);break;case"market_album":if(vk.widget)return!1;if(w){if(!i.editable)return!1;extend(i.editable,{title:i.title,msize:langNumeric(i.count,i.lang.profile_X_market_items),click:!1})}j=t.split("_");vkImage().src=i.thumb,_=p.nocl?"":' href="/market'+j[0]+"?section=album_"+j[1]+'"',m='<a class="'+("fl_l page_preview_album wall_album_cover_wrap wall_market_album_cover"+(i.thumb?"":" page_album_nocover"))+'" '+_+">\n              "+(i.thumb?'<img class="wall_album_cover" src="'+i.thumb+'"/>':"")+'\n              <div class="wall_album_caption">\n                <div class="wall_album_title_wrap clear_fix">\n                  <div class="wall_album_count fl_r">'+i.count+'</div>\n                  <div class="wall_album_title">'+i.title+"</div>\n                </div>\n              </div>\n            </a>",T=1,L=C;break;case"postpone":if(vk.widget)return!1;if(m='<div class="medadd_h medadd_h_timer inl_bl">'+i.lang.profile_choose_timer+'<span id="postpone_preview'+k+'"></span></div>',cur.editingPost&&!v)t=intval(t),i.date=t||intval(cur.editingPost[7]),ge("wpe_save").innerHTML=getLang("global_save");else if(cur.editingPost&&"wpe_media_preview"==domPN(B).id){t=intval(t),i.date=t||intval(cur.editingPost[7]);var H=geByClass1("medadd_c_timersett",B);if(H){var W=domPN(H);H=W.innerHTML,re(W)}else H="";ge("wpe_save").innerHTML=getLang("global_save")}else{i.draft?i.date=intval(t):cur.postponedLastDate&&(i.date=intval(cur.postponedLastDate)+3600);var K=ge("official"),G=gpeByClass("_submit_post_box",K);if(K&&G){var V=domData(G,"from-oid"),$=domData(G,"oid");V==vk.id&&$&&wall.setReplyAsGroup(K,{from:$}),disable(K);var X=window.data(K,"tt");if(X&&X.rdBtns){var Y=X.rdBtns[1],Q=X.rdBtnsGroup,Z=domData(Y,"as");radiobtn(Y,Z,Q)}}(Y=ge("send_post"))&&(Y.innerHTML=i.lang.profile_wall_postpone_btn)}var J=Math.round((new Date).getTime()/1e3);intval(i.date)<J&&(i.date=J+3600),hide(domByClass(b.menuNode,"_type_postpone")),L=B;break;case"mark_as_ads":if(vk.widget)return!1;m='<div class="medadd_h medadd_h_mark_as_ads inl_bl">'+i.lang.global_ads_wall_post_mark_as_ads_action+"</div>",hide(domByClass(b.menuNode,"_type_mark_as_ads")),L=B;break;case"wall":if(vk.widget)return!1;m='<div class="medadd_c_wall"><a target="_blank" href="'+i.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+i.href+'">'+i.author+'</a><div class="medadd_c_wall_type">'+i.lang.title+"</div></div>",N=' id="pam'+k+"_wall"+t+'"',hide(e);break;case"wall_reply":if(vk.widget)return!1;m='<div class="medadd_c_wall"><a target="_blank" href="'+i.href+'"><img class="medadd_c_wall_thumb fl_l" src="'+i.thumb+'" /></a><div class="medadd_c_wall_info fl_l"><a class="medadd_c_wall_author" target="_blank" href="'+i.href+'">'+i.author+'</a><div class="medadd_c_wall_type">'+i.lang.title+"</div></div>",N=' id="pam'+k+"_wall_reply"+t+'"',hide(e)}if(v){var ee=u.chosenMedias,ae=n?c:ee.length,te="";te=(!w||1!==T)&&("photos_list"==a?se('<div class="page_preview_'+a+'_wrap" style="position: relative">'+m+'<div class="page_photos_count">'+t.split(",").length+"</div></div>"):se('<div class="page_preview_'+a+'_wrap"'+(p.nocl?' style="cursor: default"':"")+N+">"+m+'<div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+u.lnkId+"].unchooseMedia("+ae+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+I+"</div>")),addClass(te,T?"fl_l":"clear_fix"),void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),p.toggleLnk&&!n&&toggle(e,u.attachCount()+1<g),w&&1===T?(addClass(L,"editable_thumbs_wrap"),L=domLC(L)&&hasClass(domLC(L),"editable_thumbs")?domLC(L):L.appendChild(ce("div",{id:"thumbs_edit"+k,className:"editable_thumbs"})),stManager.add(["thumbs_edit.css","thumbs_edit.js"],function(){if(ee[ae]&&(ee[ae].type===a||ee[ae].media!==t)){p.toggleLnk&&!n&&toggle(e,u.attachCount()+1<g),i.editable.remove=u.unchooseMedia.pbind(ae),show(domPN(L));var o=ThumbsEdit.convert(a,t,i.editable);domFC(L)?n?ThumbsEdit.updateMedia(L,a,t,i):ThumbsEdit.addMedia(L,o):p.teWidth&&p.teHeight?ThumbsEdit.init(L,[o],{width:p.teWidth,height:p.teHeight,force:!0,onMove:p.onAddMediaChange,onUpdate:p.onChangedSize}):ThumbsEdit.init(L,[o],{onMove:p.onAddMediaChange,force:!0,onUpdate:p.onChangedSize}),toggleClass(y,"media_preview_has_medias",u.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),p.onChangedSize&&p.onChangedSize()}},!0)):(show(L),n?L.replaceChild(te,ee[c][2]):L.appendChild(te),f&&(L==S?stManager.add(["sorter.js"],function(){var e=getXY(S),a=getSize(S),t=function(){S.sorter?sorter.added(S):L.childNodes.length>1&&sorter.init(S,{onReorder:p.onAddMediaChange})};e[0]||e[1]||a[0]||a[1]?t():cur.sorterClbk=t,p.onChangedSize&&p.onChangedSize()},!0):L==x&&stManager.add(["qsorter.js"],function(){x.qsorter?qsorter.added(x):L.childNodes.length>1&&qsorter.init(x,u.qsorterOpts()),p.onChangedSize&&p.onChangedSize()},!0)),p.onChangedSize&&p.onChangedSize()),n?ee[c]=[a,t,te,o,h]:ee.push([a,t,te,o,h])}else{ae=0;"postpone"===a?ae=1:"mark_as_ads"===a&&(ae=2);te=se('<div class="'+(!1===T?"page_docs_preview":"page_pics_preview")+(ae?"":" post_thumbed_media")+'"><div class="page_preview_'+a+'_wrap"'+(p.nocl?' style="cursor: default"':"")+N+">"+m+'<div nosorthandle="1" class="page_media_x_wrap inl_bl" data-title="'+getLang("dont_attach")+'" aria-label="'+getLang("dont_attach")+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia['+u.lnkId+"].unchooseMedia("+ae+'); return cancelEvent(event);"><div class="page_media_x" nosorthandle="1"></div></div>'+I+"</div></div>");addClass(te,T?"fl_l":"clear_fix"),void 0!==i.upload_ind&&re("upload"+i.upload_ind+"_progress_wrap"),"postpone"!==a&&"mark_as_ads"!==a&&(u.chosenMedia=[a,t],u.chosenMediaData=i),u.singleAdded(te,a)}"share"==a?!i.title||o||i.url?i.video?(cur.shareShowImg=0,u.bigLink=!0,u.showExternalPreview()):u.showExternalPreview():(cur.shareShowImg=0,u.showPreview(!0),u.shareData.images=!1):"page"==a?i.nopreview||(cur.shareShowImg=0,u.shareData=extend(u.shareData||{},i,{images:!1}),u.showPreview()):"poll"===a?u.pollCreate(i):"postpone"==a?u.setupPostpone(i,H):"mark_as_ads"==a?u.markAsAds=1:"pretty_cards"==a&&u.createPrettyCards(i),toggleClass(y,"media_preview_has_medias",u.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),p.onChangedSize&&p.onChangedSize();var ie=window.event;return ie&&"click"==ie.type&&(ie.ctrlKey||ie.metaKey||ie.shiftKey)&&u.attachCount()+1<=g&&(d=!0),cur.fileApiUploadStarted&&void 0!==i.upload_ind||cur.preventBoxHide||!0===d||inArray(a,["poll","share","page","postpone","mark_as_ads","pretty_cards"])||boxQueue.hideLast(),cur.lastPostMsg=!1,p.onMediaAdd&&p.onMediaAdd(),getAudioPlayer().updateCurrentPlaying(),cur.onMediaChanged&&cur.onMediaChanged(u.chosenMedias),void 0!==i.upload_ind&&delete i.upload_ind,!1}function oe(e,a){return isString(e)?e=clean(unclean(unclean(e))):(isObject(e)||isArray(e))&&(e=de(e,a)),e}function de(e,a){if(!vk.widget)return e;if((a=positive(a))>5)return e;if(isArray(e))e.forEach(function(t,i){e[i]=oe(t,a+1)});else if(isObject(e))for(var t in e)e.hasOwnProperty(t)&&(e[t]=oe(e[t],a+1));return e}},unchooseMedia:function(a,t){if(u.onChange&&!1===u.onChange(!1,a))return!1;if(v){if(cur.checkURLDomainRequest&&cur.checkURLDomainRequest.abort(),clearTimeout(cur.showLoaderTimeout),clearInterval(cur.shareImgInterval),clearTimeout(cur.shareImgInterval2),clearTimeout(cur.imgLoadTimeout),clearTimeout(cur.checkURLDomainTO),void 0===a){if(window.ThumbsEdit&&ThumbsEdit.removeAll("thumbs_edit"+k),each(u.chosenMedias,function(e,a){!a||void 0===e||t&&!inArray(a[0],t)||u.unchooseMedia(e)}),u.urlsCancelled=[],p.onChangedSize){p.onChangedSize();var i=setInterval(p.onChangedSize,50);setTimeout(clearTimeout.bind(null,i),500)}return}var o=u.chosenMedias;if(o[a]){switch(o[a][2]?((l=geByClass1("page_media_x_wrap",o[a][2],"div"))&&l.tt&&l.tt.el&&l.tt.destroy(),domPN(o[a][2])==S&&S.sorter?(each(S.sorter.elems,function(){setStyle(this,{top:"auto",left:"auto",cursor:"auto"})}),S.sorter.destroy(),re(o[a][2]),S.childNodes.length>1&&sorter.init(S,{onReorder:p.onAddMediaChange})):domPN(o[a][2])==x&&x.qsorter?(each(x.qsorter.elems,function(){setStyle(domFC(this),{top:"auto",left:"auto"}),setStyle(this,{cursor:"auto"})}),x.qsorter.destroy(),re(o[a][2]),x.childNodes.length>1&&qsorter.init(x,u.qsorterOpts())):re(o[a][2])):"photo"!=o[a][0]&&"video"!=o[a][0]&&"album"!=o[a][0]||window.ThumbsEdit&&ThumbsEdit.removeById("thumbs_edit"+k,o[a][0]+o[a][1]),o[a][0]){case"page":case"share":u.shareData={},re(u.sharePreview),hide("medadd_c_linkimg_loader"),delete u.sharePreview,show(domByClass(b.menuNode,"_type_share")),show(e),(d=ge("signed"))&&disable(d,!isChecked("official"));break;case"pretty_cards":var d;re(u.prettyCardGallery.el),delete u.prettyCardGallery,(d=ge("signed"))&&disable(d,!isChecked("official")),show(domByClass(b.menuNode,"_type_pretty_cards")),show(e);break;case"poll":re(u.pollPreview),delete u.pollPreview,show(domByClass(b.menuNode,"_type_poll"));break;case"map":show(domByClass(b.menuNode,"_type_map"));break;case"market":case"wall":case"wall_reply":case"story":show(e);break;case"postpone":var r=geByClass1("medadd_c_timersett",u.postponePreview);cur.editingPost&&r?re(domFC(u.postponePreview)):re(u.postponePreview),u.postponePreview=!1;var s=ge("official");s&&disable(s,!1),cur.editingPost?ge("wpe_save").innerHTML=getLang("wall_publish_now"):ge("send_post").innerHTML=getLang("wall_send"),show(domByClass(b.menuNode,"_type_postpone"));break;case"mark_as_ads":show(domByClass(b.menuNode,"_type_mark_as_ads")),u.markAsAds=!1}o[a]=!1}p.toggleLnk&&toggle(e,u.attachCount()<g),toggle(C,!!(w?geByClass1("thumb_wrap",C):domFC(C))),toggle(x,!!domFC(x)),toggle(S,!!domFC(S)),toggle(M,!!domFC(M)),toggle(P,!!domFC(P)),toggle(A,!!domFC(A)),toggle(B,!!domFC(B)),toggle(I,!!domFC(I))}else{var n,l;if(void 0==a&&(a=0),(l=geByClass("page_media_x_wrap",y,"div")[a])&&l.tt&&l.tt.el&&l.tt.destroy(),1==a&&u.postponePreview){show(geByClass1("add_media_type_"+k+"_postpone",b.menuNode,"a"));var c=domPN(u.postponePreview);window.tooltips&&tooltips.destroyAll(c),re(c),u.postponePreview=!1;var _=b.lastTypes;each(b.types,function(e,a){"postpone"===a[0]&&_.push(a)}),b.setItems(_)}else if(2==a&&u.markAsAds){u.markAsAds=!1;var h=geByClass1("page_preview_mark_as_ads_wrap",y);window.tooltips&&h&&tooltips.destroyAll(h),re(h);_=b.lastTypes;each(b.types,function(e,a){"mark_as_ads"===a[0]&&_.push(a)}),b.setItems(_)}else{if(u.postponePreview||u.markAsAds){c=u.postponePreview&&domPN(u.postponePreview),h=u.markAsAds&&domPN(geByClass1("page_preview_mark_as_ads_wrap",y));for(var m=[],f=0;f<y.childNodes.length;f++){var T=y.childNodes[f];"DIV"==T.nodeName&&T!=c&&T!=h&&m.push(T)}each(m,function(e,a){re(a)});_=[];each(b.types,function(e,a){"postpone"===a[0]&&u.postponePreview||"mark_as_ads"===a[0]&&u.markAsAds||_.push(a)}),b.setItems(_)}else val(y,""),addClass(y,"med_no_attach"),b.setItems(b.types);u.chosenMedia&&(u.chosenMedia=!1,u.chosenMediaData=!1),(n=u.shareData)&&(n.url&&u.urlsCancelled.push(n.url),n.initialPattern&&u.urlsCancelled.push(n.initialPattern),u.shareData={}),each([u.sharePreview,u.pollPreview],function(){re(this)}),u.sharePreview=u.pollPreview=!1}p.toggleLnk&&show(e)}if(toggleClass(y,"media_preview_has_medias",u.hasVisibleRows()&&(isVisible(e)||!hasClass("signed","disabled"))),cur.onMediaChanged&&cur.onMediaChanged(o),cur.lastPostMsg=!1,u.onChange&&u.onChange(!1),p.onChangedSize){p.onChangedSize();i=setInterval(p.onChangedSize,50);setTimeout(clearTimeout.bind(null,i),500)}},singleAdded:function(a,t){"postpone"===t?y.appendChild(a):"mark_as_ads"===t?u.postponePreview?y.insertBefore(a,domLC(y)):y.appendChild(a):domFC(y)?y.insertBefore(a,domFC(y)):y.appendChild(a),removeClass(y,"med_no_attach");var i=[];each(b.lastTypes,function(e,a){("postpone"!==a[0]||!u.postponePreview&&"postpone"!==t)&&("mark_as_ads"!==a[0]||!u.markAsAds&&"mark_as_ads"!==t)&&(inArray(t,["postpone","mark_as_ads"])||inArray(a[0],["postpone","mark_as_ads"]))&&i.push(a)}),b.setItems(i),p.toggleLnk&&!i.length&&hide(e)},getMedias:function(){if(v){var e=window.ThumbsEdit?ThumbsEdit.getMedias("thumbs_edit"+k):[],a={},t=u.chosenMedias||[],i=[],o=function(e,t,o){if(o[0]+o[1]==e)return i.push(o),a[e]=!0,!1};return each(e,function(e,a){each(t,o.pbind(a[0]+a[1]))}),each(x.childNodes,function(e,a){var i=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);i&&each(t,o.pbind(i[1]+i[2]))}),each(S.childNodes,function(e,a){var i=(a.id||"").match(/^pam\d+_([a-z]+)(-?\d+_\d+)/);i&&each(t,o.pbind(i[1]+i[2]))}),each(t,function(e,t){t&&isArray(t)&&t.length&&!a[t[0]+t[1]]&&i.push(t)}),i}return(t=u.chosenMedia)?[t[0]+t[1]]:[]},showPhoto:function(e){function a(a,t,i,o){return e.apply(this,arguments)}return a.toString=function(){return e.toString()},a}(function(e,a,t,i){for(var o in!cur.pvData||cur.pvShown&&cur.pvListId==a||delete cur.pvData[a],ajaxCache)o.toString().match(/^\/al_photos\.php\#act=show&draft_photos/)&&delete ajaxCache[o];var d=u.getMedias(),r=[];return each(d,function(e,a){a&&"photo"==a[0]&&r.push(a[1]+"/"+(u.phLists[a[1]]||""))}),t.additional={},t.additional.open_pe=intval(cur.openEditor),cur.openEditor||(t.additional.draft_photos=r.join(";")),delete cur.openEditor,showPhoto(e,a,extend(t,{queue:1}),i)}),showMediaProgress:function(a,t,i){if(u.onProgress&&!1===u.onProgress(a,t,i))return!1;var o=i.loaded/i.total,d=intval(100*o),r=(i.fileName||i.name||"").replace(/[&<>"']/g,""),s=r?t+"_"+r:t,n=r?r.length>33?r.substr(0,30)+"...":r:"",l=ge("upload"+s+"_progress");if(l){show(l);h=geByClass1("ui_progress_bar",l);setStyle(h,{width:d+"%"})}else{cur.attachMediaIndexes||(cur.attachMediaIndexes={}),cur.attachMediaIndexes[s]=k;var c='\n          <div class="fl_l">\n            <div class="page_attach_progress_wrap" style="margin-top: 3px; margin-bottom: 4px;">\n              <div id="upload'+s+'_progress" class="page_attach_progress ui_progress">\n                <div class="ui_progress_back"></div>\n                <div class="ui_progress_bar"></div>\n              </div>\n            </div>\n          </div>\n          '+(n?'<div class="attach_label fl_l">'+n+"</div>":"")+'\n          <div class="progress_x fl_l" onmouseover="animate(this, {opacity: 1}, 200);showTooltip(this, {text: \''+getLang("dont_attach")+'\', shift: [16, 8, 8], black: 1})" onmouseout="animate(this, {opacity: 0.6}, 200);" onclick="Upload.terminateUpload('+t+", '"+(r||t)+"', this);\"></div>\n          ";if(v)I.appendChild(ce("div",{id:"upload"+s+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"},{marginTop:"6px"})),show(I),p.toggleLnk&&toggle(e,u.attachCount()<g);else{var _=ce("div",{id:"upload"+s+"_progress_wrap",innerHTML:c,className:"clear_fix upload_"+t+"_progress"});u.chosenMedia="progress",u.singleAdded(_,"progress")}p.onChangedSize&&p.onChangedSize(),l=ge("upload"+s+"_progress");var h=geByClass1("ui_progress_bar",l);d?setStyle(h,{width:d+"%"}):(setStyle(h,{width:"1px"}),hide(l))}},hasVisibleRows:function(){var e=!1;return each(geByClass("media_preview",y),function(){if(isVisible(this))return e=!0,!1}),e},attachCount:function(){if(u.attachedCount)return u.attachedCount();if(!y)return 0;if(!v)return y.childNodes.length-(u.postponePreview?1:0)-(u.markAsAds?1:0);var e=(w&&window.ThumbsEdit?(ThumbsEdit.cache()["thumbs_edit"+k]||{}).previews||[]:C.childNodes).length+x.childNodes.length+A.childNodes.length+S.childNodes.length/(S.sorter?2:1)+I.childNodes.length;return u.sharePreview&&++e,u.pollPreview&&++e,e},pollCreate:function(e){var a=e.poll_html;if(cur.addMedia[k].pollInputData=e,M)if(a){var t='<div class="medadd_c" id="poll_dummy'+k+'">'+a+"</div>";u.pollPreview=M.appendChild(domFC(cf(t)))}else stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){var a=e.question,t=e.lang,i=e[d],h=e.answers,m=e[r],g=e[s],v=e[n],w=e[l],f=e[c],b=e[_],y=e.poll_is_board,C=e.poll_is_edit,x=e.poll_is_not_posted,S=e.poll_backgrounds,P=e.poll_answers_limit||10,A='\n          <div class="medadd_h medadd_h_poll inl_bl">'+t.question+'</div>\n          <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_question'+(y&&C?" disabled":"")+'"'+(y&&C?' readonly="readonly"':"")+' id="create_poll_question%lnkid%" value="%question%" />\n          <div class="medadd_h">'+t.answers+'</div>\n          <div class="medadd_poll_answers" id="create_poll_answers%lnkid%">\n            %answers%\n          </div>\n          '+(y&&C?"":'<div class="medadd_poll_answer_add_wrap" id="create_poll_add%lnkid%">\n            <div class="medadd_poll_answer_add fakeinput dark" onclick="cur.addMedia[%lnkid%].pollAnswerAdd()">'+t.answer_add+"</div>\n          </div>")+'\n          %backgrounds%\n          %settings%\n          <div class="checkbox medadd_datepicker_checkbox medadd_poll_cb%classuntil%" id="create_poll_until%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+t.until+'</div>\n          <div class="medadd_datepicker">\n            <input type="text" class="medadd_datepicker_date dark" id="create_poll_untildate%lnkid%"/><div class="medadd_datepicker_at datepicker_at">'+t.at+'</div><input type="text" class="medadd_datepicker_time dark" id="create_poll_untiltime%lnkid%"/>\n          </div>\n          '+(y?'\n          <div class="checkbox medadd_poll_cb%classonmain%" id="create_poll_onmain%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+t.add_to_main+"</div>\n          ":"")+"\n          "+(y&&C?'\n          <div class="checkbox medadd_poll_cb%classclosed%" id="create_poll_closed%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+t.close+"</div>\n          ":"")+"\n        ",B='\n          <div class="medadd_h">'+t.settings+"</div>\n          "+(C&&!x||y?"":'<div class="checkbox medadd_poll_cb%classanon%" id="create_poll_anonymous%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+t.anonymous+"</div>")+"\n          "+(C?"":'<div class="checkbox medadd_poll_cb%classmulty%" id="create_poll_multy%lnkid%" onclick="checkbox(this);cur.addMedia[%lnkid%].pollChanged();">'+t.multy+"</div>")+"\n        ",I='\n          <div class="medadd_poll_answer_wrap">\n            <input onkeydown="cur.addMedia[%lnkid%].pollKeydown(this, event)" onkeyup="cur.addMedia[%lnkid%].pollKeyup(this, event)" class="text dark medadd_poll_answer'+(y&&C?" disabled":"")+'"'+(y&&C?' readonly="readonly"':"")+' %attrs%/>\n            <div class="page_media_x_wrap medadd_poll_answer_remove" data-title="'+t.answer_remove+'" aria-label="'+t.answer_remove+'" role="button" onmouseover="showTitle(this)" onclick="cur.addMedia[%lnkid%].pollAnswerRemove(this)">\n              <div class="page_media_x"></div>\n            </div>\n          </div>\n        ',T='\n          <div class="medadd_h">'+t.background+'</div>\n          <div class="medadd_poll_backgrounds_wrap" id="create_poll_backgrounds_wrap%lnkid%">\n            <div class="medadd_poll_backgrounds_arrow_prev" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging(\'prev\')"></div>\n            <div class="medadd_poll_backgrounds_arrow_next" onclick="cur.addMedia[%lnkid%].pollBackgroundsPaging(\'next\')"></div>\n            <div class="medadd_poll_backgrounds" id="create_poll_backgrounds%lnkid%">\n              %backgrounds%\n            </div>\n          </div>\n        ';cur.addMedia[k].answersLimit=P,cur.addMedia[k].tplAnswer=I;var L="";y||(L+=cur.addMedia[k].pollBackgroundGetHtml(),S&&S.forEach(function(e){L+=cur.addMedia[k].pollBackgroundGetHtml(e)}),L+=rs('\n          <div class="medadd_poll_background medadd_poll_background_uploader" onclick="cur.addMedia[%lnkid%].pollBackgroundUpload(this);">\n            <div class="medadd_poll_background_preview"></div>\n          </div>\n        ',{lnkid:k}),L=rs(T,{lnkid:k,backgrounds:L}));var N="";if(!h||isArray(h)&&!h.length){var D=[];for(var E in e)if(e.hasOwnProperty(E)){var U="answers".length+1;if("answers["===E.substr(0,U)){var z=intval(E.slice(U,-1));D.push([z,e[E]])}}D.length?(h=[],D.sort(function(e,a){return e[0]<0&&a[0]<0?e[0]<a[0]:e[0]>=0&&a[0]>=0?e[0]>a[0]:a[0]<0}).forEach(function(e){h.push([e[0]<0?e[0]:0,e[1]])})):h=[[0,""],[0,""]]}if(h.forEach(function(e,a){var t=o(e,2),i=t[0],d=t[1];N+=rs(I,{attrs:(i?' id="create_poll_ans'+i+'"':"")+(d?' value="'+clean(unclean(d))+'"':""),lnkid:k})}),u.pollPreview=M.appendChild(ce("div",{className:"medadd_c medadd_poll",innerHTML:rs(A,{lnkid:k,question:a?clean(unclean(a)):"",classuntil:f?" on":"",settings:rs(B,{lnkid:k,classanon:i?" on":"",classmulty:b?" on":""}),backgrounds:L,answers:N,classonmain:m?" on":"",classclosed:g?" on":""})})),h.length==P&&hide("create_poll_add"+k),new Datepicker("create_poll_untildate"+k,{time:"create_poll_untiltime"+k,width:157,noPast:!0,activePeriod:2592e6,minStep:1,date:f||Math.round(((new Date).getTime()+864e5)/1e3),onUpdate:function(){return cur.addMedia[k].pollChanged()}}),cur.addMedia[k].pollBackgroundsPos=0,cur.addMedia[k].pollBackgroundSelect(w?-w:intval(v)),a)elfocus("create_poll_question"+k),p.onChangedSize&&p.onChangedSize(),cur.addMedia[k].pollUpdateArrows();else{u.pollPreview.style.position="absolute",u.pollPreview.style.visibility="hidden";var R=u.pollPreview.offsetHeight;u.pollPreview.style.height=0,u.pollPreview.style.position="",u.pollPreview.style.visibility="",animate(u.pollPreview,{height:R},p.mail?0:200,function(){u.pollPreview.style.height="",elfocus("create_poll_question"+k),p.onChangedSize&&p.onChangedSize(),cur.addMedia[k].pollUpdateArrows()})}var q=ge("create_poll_backgrounds_wrap"+k);function F(){addEvent(q,browserFeatures.wheelEvent,cur.addMedia[k].pollMouseWheel)}function j(){removeEvent(q,browserFeatures.wheelEvent,cur.addMedia[k].pollMouseWheel)}addEvent(q,"mouseenter",F),addEvent(q,"mouseleave",j),cur.destroy.push(function(){removeEvent(q,browserFeatures.wheelEvent,cur.addMedia[k].pollMouseWheel),removeEvent(q,"mouseenter",F),removeEvent(q,"mouseleave",j)})})},pollMouseWheel:function(e){cancelEvent(e);var a=Math.abs(e.deltaY)>Math.abs(e.deltaX)?e.deltaY:e.deltaX;cur.addMedia[k].pollBackgroundsPaging(a,!0)},pollBackgroundsPaging:function(e,a){var t=ge("create_poll_backgrounds_wrap"+k),i=ge("create_poll_backgrounds"+k),o=t.offsetWidth,d=cur.addMedia[k].pollBackgroundsPos;isNumeric(e)?d+=e:"next"===e?d+=o:d-=o,cur.addMedia[k].pollBackgroundsPos=Math.max(0,Math.min(d,i.scrollWidth-o)),a?removeClass(i,"animated"):addClass(i,"animated"),setStyle(i,"transform","translateX("+cur.addMedia[k].pollBackgroundsPos*(vk.rtl?1:-1)+"px)"),cur.addMedia[k].pollUpdateArrows()},pollUpdateArrows:function(){var e=ge("create_poll_backgrounds_wrap"+k),a=ge("create_poll_backgrounds"+k);if(e){var t=e.offsetWidth,i=a.scrollWidth-t;toggleClass(e,"medadd_poll_backgrounds_arrow_prev_disabled",0===cur.addMedia[k].pollBackgroundsPos),toggleClass(e,"medadd_poll_backgrounds_arrow_next_disabled",cur.addMedia[k].pollBackgroundsPos===i||i<=0)}},pollUntilGet:function(){var e=isChecked("create_poll_until"+k)?positive(val("create_poll_untildate"+k)):0;return Math.min(e,(new Date).getTime()+2592e6)},pollBackgroundChange:function(e,a){var t=gpeByClass("medadd_poll_backgrounds",e),i=geByClass1("medadd_poll_background_radio",e);geByClass("medadd_poll_background_radio",t).forEach(function(e){checkbox(e,e===i)}),cur.addMedia[k].pollChanged()},pollAnswerAdd:function(){var e=ge("create_poll_answers"+k),a=geByClass("medadd_poll_answer_wrap",e).length,t=cur.addMedia[k].answersLimit;if(a<t){var i=cf(rs(cur.addMedia[k].tplAnswer,{lnkid:k}));e.appendChild(i);var o=geByClass("medadd_poll_answer",e).pop();elfocus(o)}p.onChangedSize&&p.onChangedSize(),toggle("create_poll_add"+k,a<t-1)},pollAnswerRemove:function(e){e.tt&&e.tt.el&&e.tt.destroy(),re(domPN(e)),p.onChangedSize&&p.onChangedSize(),cur.addMedia[k].pollChanged(),show("create_poll_add"+k)},pollKeydown:function(e,a){if((a=a||window.event)&&(10==a.keyCode||a.keyCode==KEY.ENTER||a.keyCode==KEY.TAB)){var t=hasClass(e,"medadd_poll_question"),i=a.shiftKey;if(t&&i)return;var o=t?domFC(domNS(domNS(e))):(i?domPS:domNS)(domPN(e));return o?elfocus(geByTag1("input",o)):i?elfocus(geByClass1("medadd_poll_question",domPN(domPN(domPN(e))))):this.pollAnswerAdd(),cancelEvent(a)}},pollKeyup:function(e,a){(!(a=a||window.event)||10!=a.keyCode&&a.keyCode!=KEY.ENTER&&a.keyCode!=KEY.TAB)&&(cur.addMedia[k].pollChangedTimeout&&clearTimeout(cur.addMedia[k].pollChangedTimeout),cur.addMedia[k].pollChangedTimeout=setTimeout(function(){return cur.addMedia[k].pollChanged()},100))},pollBackgroundGetHtml:function(e){var a="",t=o(e||[0],1)[0];if(t<0){var i=o(e,5),d=i[1],r=i[2],s=i[3],n=i[4];a='\n          <div class="medadd_poll_background" onclick="cur.addMedia['+k+'].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview">\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n              <div class="medadd_poll_background_photo" style="background: rgb('+r+", "+s+", "+n+');">\n                <div class="medadd_poll_background_photo_holder">\n                  <div class="medadd_poll_background_photo_gradient" style="background: linear-gradient(0, rgba('+r+", "+s+", "+n+", 1) 0, rgba("+r+", "+s+", "+n+', 0) 50%)"></div>\n                  <img src="'+d+'" class="medadd_poll_background_photo_img"/>\n                </div>\n              </div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="'+t+'" data-photo-r="'+r+'" data-photo-g="'+s+'" data-photo-b="'+n+'" data-photo-url="'+d+'"></div>\n          </div>\n        '}else{var l="",c="";if(t){var _=o(e,2)[1];if("gradient"===_){var p=o(e,4),u=p[2],h=[];p[3].forEach(function(e){var a=o(e,2),t=a[0],i=a[1];h.push("#"+i+" "+Math.round(100*t)+"%")}),l="background: linear-gradient("+(u-90)+"deg, "+h.join(",")+');"'}else if("tile"===_){var m=o(e,5),g=m[2],v=m[3];l="background: url("+m[4]+") top center;background-size: "+g+"px "+v+'px;"'}}else c=" medadd_poll_background_default";a='\n          <div class="medadd_poll_background'+c+'" onclick="cur.addMedia['+k+'].pollBackgroundChange(this);">\n            <div class="medadd_poll_background_preview"'+(l?' style="'+l+'"':"")+'>\n              <div class="medadd_poll_background_preview_lines1"></div>\n              <div class="medadd_poll_background_preview_lines2"></div>\n            </div>\n            <div class="medadd_poll_background_radio radiobtn" data-id="'+t+'"></div>\n          </div>\n        '}return a},pollBackgroundAdd:function(e){var a=ge("create_poll_backgrounds"+k),t=geByClass1("medadd_poll_background_uploader",a),i=cf(cur.addMedia[k].pollBackgroundGetHtml(e));i=domFC(i),a.insertBefore(i,t)},pollBackgroundSelect:function(e){var a=ge("create_poll_backgrounds"+k);if(a){var t=domQuery1('.radiobtn[data-id="'+e+'"]',a)||domQuery1('.radiobtn[data-id="0"]',a);if(t){var i=domPN(t);cur.addMedia[k].pollBackgroundsPos=(i.offsetLeft-a.offsetWidth/2+i.offsetWidth/2)*(vk.rtl?-1:1),cur.addMedia[k].pollBackgroundsPaging(0,!0),cur.addMedia[k].pollBackgroundChange(i)}}},pollBackgroundGet:function(){var e=domQuery1("#create_poll_backgrounds"+k+" .radiobtn.on");return intval(domData(e,"id"))},pollBackgroundUploaded:function(e,a,t){var i=-intval(e);cur.addMedia[k].pollBackgroundAdd([i,clean(a),intval(t.r),intval(t.g),intval(t.b)]),cur.addMedia[k].pollBackgroundSelect(i)},pollBackgroundUpload:function(){var e=cur.addMedia[k].pollInputData;showBox("al_page.php",{act:"owner_photo_box",oid:e&&e.poll_owner_id||(p.mail?cur.gid?-cur.gid:vk.id:cur.oid||vk.id),lnk_id:k,is_voting:1},{stat:["owner_photo.css","owner_photo.js"]})},pollChanged:function(){p.onMediaChange&&p.onMediaChange()},pollBackgroundsGet:function(){var e=cur.addMedia[k].pollInputData,a=[];e&&e.poll_backgrounds&&e.poll_backgrounds.forEach(function(e){o(e,1)[0]>0&&a.push(e)});var t=ge("create_poll_backgrounds"+k);return geByClass("radiobtn",t).forEach(function(e){var t=intval(domData(e,"id"));t&&t<0&&a.push([t,domData(e,"photo-url"),intval(domData(e,"photo-r")),intval(domData(e,"photo-g")),intval(domData(e,"photo-b"))])}),a},pollData:function(e,a){var t=cur.addMedia[k],i={};if(t&&ge("create_poll_question"+k)){for(var u=ge("create_poll_answers"+k),h=!1,m=0,g=domFC(u);g;g=domNS(g)){var v=trim(val(domFC(g)));if(v){var w=-intval((domFC(g).id.match(/^create_poll_ans(\d+)$/)||[0,-m++])[1]);i["answers["+w+"]"]=v,h=!0}}if(!h)return domFC(u)||t.pollAnswerAdd(),!0!==e&&notaBene(domFC(domFC(u))),!1;var f=trim(val("create_poll_question"+k));if(!f)return!0!==e&&notaBene("create_poll_question"+k),!1;i.question=f,i[c]=t.pollUntilGet();var b=t.pollBackgroundGet();if(b<0?(i[l]=-b,i[n]=0):b>=0&&(i[l]=0,i[n]=b),i[d]=isChecked("create_poll_anonymous"+k)?1:0,i[r]=isChecked("create_poll_onmain"+k)?1:0,i[s]=isChecked("create_poll_closed"+k)?1:0,i[_]=isChecked("create_poll_multy"+k)?1:0,t.pollInputData&&a){i.poll_backgrounds=t.pollBackgroundsGet();var y=["poll_is_board","poll_is_edit","poll_id","poll_answers_limit"];p.mail&&y.push("lang"),y.forEach(function(e){t.pollInputData[e]&&(i[e]=t.pollInputData[e])}),p.mail&&(i.poll_is_edited=0,i["answers[0]"]||i.question!=t.pollInputData.question?i.poll_is_edited=1:[d,r,s,_,c,l,n].forEach(function(e){intval(i[e])!==intval(t.pollInputData[e])&&(i.poll_is_edited=1)}),i.poll_is_edited||t.pollInputData.answers.forEach(function(e){var a=o(e,2),t=a[0],d=a[1];void 0!==i["answers["+-t+"]"]&&i["answers["+-t+"]"]==d||(i.poll_is_edited=1)}))}}else t&&ge("poll_dummy"+k)&&t.pollInputData&&t.pollInputData.poll_id&&(i.poll_id=t.pollInputData.poll_id);return i},urlsCancelled:[],shareData:{},checkMessageURLs:function(e,a,t){if(!(cur.noCheckMessageURLs||u.chosenMedia||u.urlAttachmentLoading&&u.urlAttachmentLoading[0]>vkNow()-1e4||u.attachCount()>=g)){if(cur.checkMessageHandler&&isFunction(cur.checkMessageHandler)&&cur.checkMessageHandler(e),cur.reply_to&&cur.reply_to[0]){var i=Wall.getReplyName(cur.reply_to[0]);if(i&&isArray(i)&&i[1]&&(i=i[1]),i){var o=extractUrls(i,a);for(var d in o){if(o.hasOwnProperty(d))(n=o[d].url).match(/^https?:\/\//)||(n="http://"+n),inArray(n,u.urlsCancelled)||u.urlsCancelled.push(n)}}}var r=extractUrls(e,a);for(var d in r)if(r.hasOwnProperty(d)){var s=r[d],n=s.url,l=s.query,c=s.domain,_=n,p={};if(n.match(/^https?:\/\//)||(n="http://"+n),inArray(n,u.urlsCancelled)||inArray(_,u.urlsCancelled))continue;var h=!0;if(c.match(/(^|\.|\/\/)(vkontakte\.ru|vk\.com)/i)){h=!!l.match(/(#photo|^\/(photo|video|album|page|audio|doc|mask|poll)|z=(album|photo|video|audio_playlist)|w=(page|product|poll))(-?\d+_)?\d+|app\d+(?:_-\d+)?|\.(jpg|png|gif)$|market-?\d+\?section=album_\d+|^\/stickers\/.+$|\?w\=story(\d+)_(\d+)$|stor(y|ies)(\d+)_(\d+)$|^(\/dev)?\/blog\/.+$|^\/jobs\?w=job\d+$|^\/landings\/.+$|\?w\=vk10\_years(\d+)$|^\/messenger$|^\/bestgames2016$|^\/bestgames2017$|^\/ads(\/([a-zA-Z0-9\_]+))?$|^http:\/\/instagram\.com\/p\/.+/);var m=l.match(/^(\/@[._a-zA-Z0-9-]+)([\?|\&]rev=[_a-z0-9]+|[\?|\&]anchor=[-a-zа-я0-9]+)*$/);if(m&&(_="vk.com"+m[1],delete(p=nav.fromStr(n))[0],h=!0),!h&&l.match(/[a-zA-Z0-9_\.-]{2,32}/))return void u.checkURLDomain(l,_,t)}if(h)return void u.checkURL(_,t,p)}}},checkURLDomain:function(e,a,t){cur.checkURLDomainTO&&clearTimeout(cur.checkURLDomainTO),cur.checkURLDomainTO=setTimeout(function(e,a,t){cur.checkURLDomainRequest=ajax.post("apps",{act:"a_aid_by_link",url:e},{onDone:function(e,i){e&&!i&&u.checkURL(a,t)},onFail:function(){return!0}})}.pbind(e,a,t),100)},clearCheckURL:function(){clearTimeout(cur.checkURLTO),re(u.urlAttachmentLoading[2]),v?toggle(I,I.childNodes>0):toggleClass(y,"med_no_attach",!y.childNodes),u.urlAttachmentLoading=!1,setStyle(bodyNode,{cursor:"default"})},onCheckURLDone:function(e,a,t){var i="";a=a||{},u.urlAttachmentLoading&&(i=u.urlAttachmentLoading[1],u.clearCheckURL()),e?u.chooseMedia(t[0],t[1],extend({},t[2],a),i,!0):((p.onCheckURLDone||function(){})(e,t),(a.onError||function(){})(t))},cancelCheckUrl:function(){re(u.checkURLForm)},_getShareTimeHash:function(){var e=cur.share_timehash||((cur.options||{}).share||{}).timehash||"",a=Math.floor(Date.now()/1e3),t=-1;return e&&(t=parseInt(e.split("_",1)[0])+36e3),t-a<60?Object(i.post)("share.php?act=renew_url_attachment_hash",{act:"renew_url_attachment_hash",hash:e}).then(function(e){var a=e[0];return cur.share_timehash=a,a}):Promise.resolve(e)},checkURL:function(e,a){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e?this._getShareTimeHash().then(function(o){u.urlsCancelled.push(e),u.urlAttachmentLoading=[vkNow(),e],re(u.checkURLForm),u.checkURLForm=ce("div",{innerHTML:'<iframe name="share_parse_iframe'+k+'"></iframe>'}),utilsNode.appendChild(u.checkURLForm);var d=u.checkURLForm.appendChild(ce("form",{action:"share.php?act=url_attachment",method:"post",target:"share_parse_iframe"+k}));each(extend({hash:o,allowed_share_buttons:((cur.options||{}).share||{}).allowed_buttons||"",index:k,url:e,to_mail:p.mail?1:""},t),function(e,a){d.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),setStyle(bodyNode,{cursor:"wait"}),window.onUploadDone=u.onCheckURLDone.pbind(!0,i),window.onUploadFail=u.onCheckURLDone.pbind(!1,i),a&&(cur.checkURLTO=setTimeout(function(){u.urlAttachmentLoading.length>0&&u.clearCheckURL()},a)),d.submit()}):(i.onError||function(){})()},addPreview:function(e){return u.sharePreview=P.appendChild(ce("div",{className:"medadd_c medadd_c_link",innerHTML:'<div class="medadd_c_linkcon"><div></div>'+(e?'<div class="medadd_c_linkprg">'+getProgressHtml("","medadd_c_linkprg_inner")+"</div>":"")+"</div>"}))},shareImgUrl:function(e){var a=u.shareData;if(isArray(a.preview_images)&&a.preview_images[e])return a.preview_images[e];if(a.images_proxy&&a.images_proxy[e])return a.images_proxy_url+a.images_proxy[e];if(a.images){var t=a.images[e];return isArray(t)&&(t=t[0]?t[0]:""),t}return""},showPreview:function(e){var t,i,o=u.shareData,d=u.sharePreview||u.addPreview();o.images&&(t=o.images[cur.shareShowImg],i=!(!u.bigLink&&!o.big_link));var r=!(!cur.options.share||!cur.options.share.allow_snippet_video),s=o.video&&r;if(o.failed)var n=getLang("page_not_loaded");else{var l,c="",_=clean(u.shareImgUrl(cur.shareShowImg));if(r&&(cur.selectSnippetVideo=function(){var e={to_id:p.toId||cur.postTo,act:"a_choose_video_box",snippet_video:1};showBox("al_video.php",e,{cache:1,dark:1})},cur.chooseSnippetVideo=function(e,a){var t=u.shareData,i=e.split("_");t.video_owner_id=i[0],t.video_id=i[1],t.video_full_id=e,t.video=a;var o=!1,d=!0,r=!1,s=void 0;try{for(var n,l=Object.keys(a.editable.sizes)[Symbol.iterator]();!(d=(n=l.next()).done);d=!0){var c=n.value;(o&&a.editable.sizes[c][1]>a.editable.sizes[o][1]||!o)&&(o=c)}}catch(e){r=!0,s=e}finally{try{!d&&l.return&&l.return()}finally{if(r)throw s}}if(o){var _=a.editable.sizes[o];t.images[t.images.length-1]=[_[0],i[0],i[1],"video",a.editable.duration],cur.shareShowNext(0,1)}u.showVideoSnippetPreview()}),o.images&&o.images[cur.shareShowImg]&&_){var h=o.images[cur.shareShowImg];if(o.images.length>0){var m=!(!cur.options.share||!cur.options.share.allow_custom_photo),g=m&&!(cur.options.share&&cur.options.share.require_image),v="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",w="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_choose_own_video")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",f="onmouseover=\"showTooltip(this, {text: '"+getLang("global_link_remove_photo")+"', black: 1, shift: [7, 11, 8], appendParentCls: 'post'})\"",b=isArray(h)&&1==h.length,k=b&&!r,y=b&&r,C=o.media&&"_"!=o.media&&m?'<div class="medadd_c_linkimg_controls">  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_l">'+(o.images.length>1?'    <div class="medadd_c_linkimg_controls_btn_arrows_group">      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_left" onclick="cur.shareShowNext(true);"></div>      <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_right" onclick="cur.shareShowNext();"></div>    </div>':"")+'    <div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload" '+v+" onclick=\"Page.ownerPhoto('"+o.media+"');\"></div>"+(r?'<div class="medadd_c_linkimg_controls_btn '+(o.images.length>1?"medadd_c_btn_side_padd":"")+'" id="medadd_ctrl_upload_video" '+w+' onclick="cur.selectSnippetVideo();"></div>':"")+"  </div>"+(g?'  <div class="medadd_c_linkimg_controls_btn_group clear_fix fl_r">    <div class="medadd_c_linkimg_controls_btn" id="medadd_ctrl_remove" '+f+' onclick="tooltips.hide(this);cur.removeLinkImage(this)"></div>  </div>':"")+"</div>":"",x=(t?"":"display: none")+";background-image:url("+_+")";o.image_ratio>0&&(x+=";height: 0px; padding-top: "+100*o.image_ratio+"%;min-height: 0px;");var S="video"===h[3];c='<div class="medadd_c_linkimg_container '+(P&&P.offsetWidth>550?"medadd_c_linkimg_container_wide":"")+'" style="'+x+'">'+c+(S?'<div class="medadd_c_linkimg_container_video_overlay"></div>':"")+(S?'<div class="video_thumb_label"><span class="video_thumb_label_item"></span><span class="video_thumb_label_item">'+h[4]+"</span></div>":"")+(k?'<div class="medadd_c_linkimg_button"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+"</button></div>":"")+(y?'<div class="medadd_c_linkimg_button"><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark" onclick="Page.ownerPhoto(\''+o.media+"');\">"+getLang("global_link_choose_own_photo")+'</button></div><div class="medadd_c_linkimg_button_half_container"><button class="flat_button secondary_dark medadd_c_linkimg_video_button" onclick="cur.selectSnippetVideo();">'+getLang("global_link_choose_own_video")+"</button></div></div>":"")+C+'<div id="medadd_c_linkimg_loader" class="medadd_c_linkimg_loader">'+getProgressHtml("","inv medadd_c_linkimg_loader_inner")+"</div></div>"}}var M="";o.microdata&&o.microdata_preview_html&&(M=o.microdata_preview_html);var A={title:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_title")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_title},description:{placeholder:'<span class="medadd_inline_placeholder">'+getLang("global_link_edit_desc")+"</span>",editable:cur.options.share&&cur.options.share.allow_edit_desc}},B=o.shareButtons,I=B&&B.length&&B[0],T=o.button_text||I&&I[1],L=o.button_text_lang||I&&I[2],N=o.button_action||I&&I[0];if(B&&B.length&&L===T)for(var D=0;D<B.length;++D)if(B[D][0]===N&&B[D][2]===T){T=B[D][1];break}var E=!1;B&&B.length&&(E=B.length>1||L===T||I[0]!==N||I[1]!==T);var U=!!B&&B.length,z=cur.options.share&&cur.options.share.allow_remove_button&&!s;n=c+'<div class="medadd_c_linkwrap '+(c?"":"no_photo")+'"><div class="medadd_c_linkwrap_block">'+(o.title||A.title.editable?'<div class="medadd_c_linkhead '+(A.title.editable?"medadd_inline_editable":"")+'">'+(A.title.editable?'<div class="medadd_inline_editable_icon"></div>':"")+'<span class="medadd_inline_edit_target" data-max-length="'+(cur.options.share&&cur.options.share.max_title_len?cur.options.share.max_title_len:0)+'" data-field="title">'+(clean(o.title).replace(/\n/g,"<br>")||A.title.placeholder)+"</span></div>":"")+(M?'<div class="medadd_c_linkmicrodata">'+M+"</div>":"")+(o.domain?'<div class="page_media_link_url medadd_c_linkaddr">'+o.domain+"</div>":"")+"</div>"+(L&&U?'<div class="medadd_c_linkwrap_block medadd_c_linkwrap_block_button">'+(z?'<div class="hide_icon medadd_c_linkbtn_remove" onclick="cur.shareRemoveButton();" onmouseover="showTooltip(this, {text: \''+getLang("global_share_button_remove_tooltip")+"', black: 1, shift: [15, 10, 0]})\"></div>":"")+'<div class="wall_postlink_preview_btn medadd_c_linkbtn"><a onclick="cur.toggleShareButton(this);return false;" onmouseout="Page.actionsDropdownHide(domNS(this), 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" class="flat_button"><span onmouseover="Page.actionsDropdownUnhide()" class="'+(E?"page_actions_dd_label":"")+' wall_postlink_preview_btn_label" data-field="button_text">'+L+"</span></a></div></div>":"")+'</div><div class="clear_fix"></div>'}if(i?addClass(domFC(d),"medadd_c_linkimg_big"):removeClass(domFC(d),"medadd_c_linkimg_big"),e)cur.preventShareAnim&&(cur.preventShareAnim.stop(),clearInterval(cur.animateUpdateInterval),p.onChangedSize&&p.onChangedSize()),val(domFC(d),n),domFC(d).style.height="auto",l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency();else{show(P);var R=ge(a).appendChild(ce("div",{innerHTML:'<div class="medadd_c_linkcon '+(i?"medadd_c_linkimg_big":"")+'">'+n+"</div>"},{position:"absolute",width:getSize(d)[0]-10,visibility:"hidden"})),q=getSize(R)[1];re(R),setStyle(domFC(d),{height:"0"}),setStyle(d,{overflow:"hidden"}),val(domFC(d),n),l&&ge("snippet_video_preview_wrap").appendChild(l),shortCurrency(),cur.animateUpdateInterval=setInterval(function(){p.onChangedSize&&p.onChangedSize()},100),cur.preventShareAnim=animate(domFC(d),{height:q},200,function(){setStyle(domFC(d),{height:"auto",display:""}),setStyle(d,{overflow:""}),clearInterval(cur.animateUpdateInterval),p.onChangedSize&&p.onChangedSize()}),re(geByClass1("medadd_c_linkprg",P))}function F(e){if(!e||e.inlineEdit)return!1;var a=getSize(e),t=gpeByClass("medadd_inline_editable",e);e.inlineEdit=!0,addClass(t,"medadd_inline_editing");var i=ce("textarea",{className:"medadd_inline_edit"},{width:a[0],height:a[1]}),o=parseInt(e.getAttribute("data-max-length"));o&&i.setAttribute("maxlength",o);var d=e.getAttribute("data-field");val(i,u.shareData[d]),val(e,""),e.appendChild(i);var r=ce("span",{className:"medadd_inline_edit_target"},{opacity:0,zIndex:-1,width:a[0],height:"auto",wordWrap:"break-all",position:"absolute"});t.appendChild(r);var s=a[1];elfocus(i),i.onblur=function(){re(r),u.shareData[d]=val(i),val(e,clean(val(i)).replace(/\n/g,"<br>")||A[d].placeholder),removeClass(t,"medadd_inline_editing"),e.inlineEdit=!1};var n=function(){var e=clean(val(i)+" M").replace(/\n/g,"<br>");if(val(r,e),!(e.length>=o)){var a=getSize(r);s!=a[1]&&(s=a[1],animate(i,{height:a[1]},200))}};addEvent(i,"click keyup change",n),setTimeout(n,0)}if(A.title.editable){var j=geByClass1("medadd_c_linkhead",domFC(d)),O=geByClass1("medadd_inline_edit_target",j);j&&O&&(j.onclick=F.bind(this,O))}if(A.description.editable){var H=geByClass1("medadd_inline_edit_target",geByClass1("medadd_c_linkdsc",domFC(d)));H&&(H.onclick=F.bind(this,H))}if(U&&(u.shareData.button_text=T,u.shareData.button_text_lang=L,u.shareData.button_action=N,E)){var W=domPN(geByClass1("wall_postlink_preview_btn_label",domFC(d))),K=[],G=0,V=0,$=[];for(var D in B)if(B.hasOwnProperty(D)){var X=B[D];X[0]==N&&X[1]==T&&(G=V),K.push([V++,X[1]]),$.push('<a class="page_actions_item" tabindex="0" role="link" onclick="cur.updateShareButton(this);Page.actionsDropdownHide(domPN(domPN(this)), 1, cur.setActiveShareButton.pbind(false));return false;" data-button-text="'+X[1]+'" data-button-text-lang="'+X[2]+'" data-button-action="'+X[0]+'">'+X[2]+"</a>")}W.setAttribute("data-items",JSON.stringify(K)),W.setAttribute("data-value",G);var Y=['<div class="page_actions_wrap medadd_c_linkbtn_actions_wrap unshown" onmouseout="Page.actionsDropdownHide(this, 0, cur.setActiveShareButton.pbind(false))" onmouseover="Page.actionsDropdownUnhide()" onmouseup="setTimeout(function() { Page.actionsDropdownUnhide(); }, 5)">','<div class="page_actions_inner">',$.join(""),"</div>","</div>"].join("");domPN(W).appendChild(se(Y)),ls.get("share_button_text_tooltip_shown")||cur.buttonTextTooltip||setTimeout(function(){cur.closeButtonTextTooltip=function(){cur.buttonTextTooltip.hide(),ls.set("share_button_text_tooltip_shown",1)};var e=geByClass1("wall_postlink_preview_btn_label",domFC(d)),a=domCA(e,".box_layout");cur.buttonTextTooltip=new ElementTooltip(e,{autoShow:!1,appendTo:a||geByTag1("body"),content:'<div class="feature_intro_tt_hide" onclick="cur.closeButtonTextTooltip();"></div>'+getLang("global_share_button_text_tooltip"),forceSide:"left",cls:"feature_intro_tt",offset:[-10,0,0],onHide:function(){cur.buttonTextTooltip.destroy()}}),cur.buttonTextTooltip.show(),addEvent(e,"mouseover",function(){cur.buttonTextTooltip&&cur.buttonTextTooltip.hide()})},1e3)}},showVideoSnippetPreview:function(){if(!(!cur.options.share||!cur.options.share.allow_snippet_video)){var e=u.shareData,a=e.video,t=e.video_owner_id,i=e.video_id;a&&isObject(a)&&t&&i&&a.editable&&(u.initSnippetButtonFunctions(),u.showPreview())}},initSnippetButtonFunctions:function(){cur.shareRemoveButton=function(){var a=u.sharePreview;window.tooltips&&tooltips.destroyAll(a),re(geByClass1("medadd_c_linkwrap_block_button",a)),u.shareData.button_text="",u.shareData.button_text_lang="",u.shareData.button_action="",show(domByClass(e,"media_selector"))},cur.updateShareButton=function(e){var a=e.getAttribute("data-button-text"),t=e.getAttribute("data-button-text-lang"),i=e.getAttribute("data-button-action");u.shareData.button_text=a,u.shareData.button_text_lang=t,u.shareData.button_action=i;var o=u.sharePreview;return val(geByClass1("page_actions_header_inner",o),t),val(geByClass1("wall_postlink_preview_btn_label",o),t),!1},cur.setActiveShareButton=function(e){var a=u.sharePreview;(e?addClass:removeClass)(domPN(geByClass1("wall_postlink_preview_btn_label",a)),"active")},cur.toggleShareButton=function(e){hasClass(e,"active")?(Page.actionsDropdownHide(domNS(e),1),cur.setActiveShareButton(!1)):(Page.actionsDropdown(domNS(e)),cur.setActiveShareButton(!0))}},showExternalPreview:function(){var e=u.shareData;e.images||(e.images=[]);var a,t=[],i=[],o={};each(e.images,function(a,d){o[d]||(o[d]=!0,t.push(d),e.images_proxy&&i.push(e.images_proxy[a]))}),e.uniqueImagesCount=t.length,e.images=t,e.images_proxy=i;var d=!(!cur.options.share||!cur.options.share.allow_snippet_video);if(a=P&&P.offsetWidth>550?isRetina()?"/images/post_snippet_image_placeholder_w_2x.png":"/images/post_snippet_image_placeholder_w.png":d?isRetina()?"/images/post_snippet_image_video_placeholder_2x.png":"/images/post_snippet_image_video_placeholder.png":isRetina()?"/images/post_snippet_image_placeholder_2x.png":"/images/post_snippet_image_placeholder.png",e.placeholder_inserted||(e.images.push([(cur.options.share||{}).allow_custom_photo?a:""]),e.placeholder_inserted=!0),!e.images||!e.images.length)return cur.shareShowImg=0,void u.showPreview();cur.shareShowImg=0,cur.shareShowImg--,u.addPreview(!0),e.imagesStyles={};var r=!1;cur.shareSetOwnPhoto=function(a){curBox()&&curBox().hide(),u.bigLink=!0,e.images[e.images.length-1]=[a.photo_url,a.user_id,a.photo_id],cur.shareShowNext(0,1)},cur.shareClearOwnPhoto=function(){e.images[e.images.length-1]=[],cur.shareShowNext(0,0,1)},cur.removeLinkImage=function(e){var a=gpeByClass("medadd_c_linkcon",e);addClass(a,"no_photo"),removeClass(a,"medadd_c_linkimg_big"),re(gpeByClass("medadd_c_linkimg_container",e)),setStyle(a,"height",""),u.shareData.noPhoto=!0},u.initSnippetButtonFunctions(),cur.shareShowNext=function(t,i,o){var d=vkImage();cur.prevShareShowDir=t,o||(i?cur.shareShowImg=e.images.length-1:t?cur.shareShowImg-=1:cur.shareShowImg+=1);var s=isArray(e.images[e.images.length-1])&&!!e.images[e.images.length-1][0];if(!s&&cur.shareShowImg>e.images.length-2)cur.shareShowImg=0;else if(cur.shareShowImg>e.images.length-1)cur.shareShowImg=0;else if(!s&&cur.shareShowImg<0)cur.shareShowImg=e.images.length-2;else if(cur.shareShowImg<0)cur.shareShowImg=e.images.length-1;else if(0==cur.shareShowImg)for(var n=1;n<e.images.length-1;n++){vkImage().src=u.shareImgUrl(n)}if(!e.images.length||isEmpty(e.images)||void 0===e.images[cur.shareShowImg])return u.showPreview(r),void(r=!0);var l=u.shareImgUrl(cur.shareShowImg);l&&(d.src=l),e.video=0,isArray(e.images[cur.shareShowImg])&&e.images[cur.shareShowImg][1]&&e.images[cur.shareShowImg][2]?"video"===e.images[cur.shareShowImg][3]?(e.video=1,e.video_owner_id=e.images[cur.shareShowImg][1],e.video_id=e.images[cur.shareShowImg][2]):(e.user_id=e.images[cur.shareShowImg][1],e.photo_id=e.images[cur.shareShowImg][2],e.share_own_image=!0):(e.user_id=void 0,e.photo_id=void 0,e.share_own_image=!1);var c=null;l&&(cur.imgLoadTimeout=c=setTimeout(function(){!0!==cur.shareImgInterval&&(isArray(e.images[cur.shareShowImg])||(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),cur.shareShowNext()))},5e3));var _=setTimeout(function(){show("medadd_c_linkimg_loader"),_=null,p.onChangedSize&&p.onChangedSize()},100);cur.showLoaderTimeout=_;var h=function(){if(d.width||d.height||!l){var t=d.width,i=d.height,o="",s="";if(c&&(clearTimeout(c),c=null),_&&(clearTimeout(_),_=null),hide("medadd_c_linkimg_loader"),clearInterval(cur.shareImgInterval),!isArray(e.images[cur.shareShowImg])&&(t<150||i<67)){if(e.images.splice(cur.shareShowImg,1),e.images_proxy&&e.images_proxy.length>cur.shareShowImg&&e.images_proxy.splice(cur.shareShowImg,1),e.images.length)return setTimeout(cur.shareShowNext.pbind(0,0,1),0)}else{var n=t>=532&&i>=235,h=n||!!e.big_link;if(cur.options.share&&cur.options.share.force_big_link&&!n){e.images.splice(cur.shareShowImg,1),e.images_proxy.splice(cur.shareShowImg,1);var m=(cur.options.share||{}).allow_custom_photo||(cur.options.share||{}).require_image;return 0==e.images.length&&m&&e.images.push([m?a:""]),cur.prevShareShowDir||cur.shareShowImg--,void cur.shareShowNext(cur.prevShareShowDir)}u.bigLink=h,h?o="width: 100%;":(t>150&&(i=150*i/t,t=150),o="width: "+t+"px; height: "+i+"px;")}e.images.length>1&&(s=""),e.imagesStyles[cur.shareShowImg]='style="'+o+'"'+s,u.showPreview(r),r=!0,p.onAddMediaChange&&p.onAddMediaChange("share",e.media,e)}};clearInterval(cur.shareImgInterval),cur.shareImgInterval=setInterval(h,300),cur.shareImgInterval2=setTimeout(h,0)},cur.shareShowNext()},uploadShare:function(e){var a=u.shareData,t=u.sharePreview,i=t.appendChild(ce("div",{innerHTML:'<iframe class="upload_frame" name="share_upload_iframe'+k+'"></iframe>'})),o=i.appendChild(ce("form",{action:"/share.php",method:"post",target:"share_upload_iframe"+k})),d=a.images[cur.shareShowImg];each({act:"a_photo",url:a.url,index:k,image:d,extra:a.extra||0,hash:vk.ip_h},function(e,a){o.appendChild(ce("input",{type:"hidden",name:e,value:a}))}),window.onUploadDone=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),u.shareData=extend(u.shareData,{user_id:o.user_id,photo_id:o.photo_id,photo_url:d}),setTimeout(e,0)},window.onUploadFail=function(a,o){window.onUploadFail=window.onUploadDone=function(){},t.removeChild(i),u.shareData.share_upload_failed=1,setTimeout(e,0)},cur.shareLastParseSubmitted=vkNow(),o.submit()},setupPostpone:function(e,a){var t;t=v||B?B:domPN(geByClass1("page_preview_postpone_wrap",y));var i=cur.editingPost&&"wpe_media_preview"==domPN(t).id,o=i||!v?"":"1px",d=!1,r='<div class="clear_fix">\n        <div class="fl_l"><input type="hidden" id="postpone_date'+k+'" value="'+(e.date||"")+'" /></div>\n        <div class="fl_l medadd_c_timerat">'+e.lang.profile_wall_postpone_at+'</div>\n        <div class="fl_l"><input type="hidden" id="postpone_time'+k+'"/></div></div>';cur.editingPost&&void 0!=e.friends_only?(r+='<div class="medadd_c_timersett">',void 0!=e.status_export&&(r+='<div class="checkbox_status_export'+(e.status_export?" on":"")+' fl_l" id="status_export'+k+'" onclick="checkbox(this)" onmouseover="showTooltip(this, {text: \''+e.lang.export_to_twitter+"', black: 1, shift: [12,4,0]});\"></div>"),void 0!=e.facebook_export&&(r+='<div class="checkbox_facebook_export'+(e.facebook_export?" on":"")+' fl_l" id="facebook_export'+k+'" onclick="checkbox(this)" onmouseover="showTooltip(this, {text: \''+e.lang.export_to_facebook+"', black: 1, shift: [12,4,0]});\"></div>"),r+='<div class="checkbox'+(e.friends_only?" on":"")+' fl_l" id="friends_only'+k+'" onclick="checkbox(this);checkbox(\'status_export'+k+"',!isChecked(this));checkbox('facebook_export"+k+"',!isChecked(this));\">"+e.lang.friends_only+"</div></div>",d=!0):cur.editingPost&&a&&(r+=a,d=!0),u.postponePreview=t.appendChild(ce("div",{className:"medadd_c medadd_c_timer clear_fix"+(d?" medadd_c_nofixed":""),innerHTML:r})),u.postponePreview.style.height=o,stManager.add(["ui_controls.css","ui_controls.js","datepicker.css","datepicker.js"],function(){new Datepicker("postpone_date"+k,{time:"postpone_time"+k,width:155,noPast:!0,minStep:1,onUpdate:p.onMediaChange}),!i&&v&&animate(u.postponePreview,{height:33},200,function(){u.postponePreview.style.height=""})})},createPrettyCards:function(e){cur.lang=extend(cur.lang||{},e.lang||{});var a=se(e.editor.container_html);P.appendChild(a),u.prettyCardGallery=new PrettyCardGallery(a,e.editor,e.pretty_cards)},destroy:function(){(S||{}).sorter&&S.sorter.destroy();for(var e=0;e<b.handlersToClean.length;e++)b.handlersToClean[e]();(x||{}).qsorter&&x.qsorter.destroy()},qsorterOpts:function(){return{xsize:Math.floor(x.offsetWidth/135),width:135,height:102,onReorder:p.onAddMediaChange,clsUp:"pam_dpic_up"}},resized:function(){window.ThumbsEdit&&ThumbsEdit.setWide("thumbs_edit"+cur.wallEditComposer.addMedia.lnkId),x.qsorter&&(x.qsorter.destroy(),window.qsorter.init(x,u.qsorterOpts()))}},cur.addMedia||(cur.addMedia={}),cur.addMedia[k]=u,p.onAddMediaChange&&(u.onChange=p.onAddMediaChange),u}};try{stManager.done(jsc("web/ui_media_selector.js"))}catch(e){}}});